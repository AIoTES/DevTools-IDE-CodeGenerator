<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
    .coordinator_path{
        display: inline-block;
    }

        table,tr,td,th{
            border: 2px solid black;
        }
        table{
            border-collapse: collapse;
        }

        #ont_table, #ont_fieldset{
            display: inline-block;
        }
        #variables_table, #vars_dieldset{
            display: inline-block;
        }
    
    </style>
    <script type="text/javascript">
    var restObj = {};
	function changeTemplate(){
		restObj.template = document.getElementById("coordinator").value;
	}

    function addRow() {
        var table = document.getElementById("variables_table");
        var row_count = table.getElementsByTagName("tr").length;
        var row = table.insertRow(row_count);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var var_name = document.getElementById("var_name").value;
        var var_val = document.getElementById("var_val").value;
        cell1.innerHTML=var_name;
        cell2.innerHTML=var_val;

        if (!restObj.hasOwnProperty("variables")) {
        	restObj.variables={}
        }
        restObj.variables[var_name]=var_val;
    }
    function addOnt(){
        var table = document.getElementById("ont_table");
        var row = table.insertRow(1);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var ont_url = document.getElementById("ontology").value;
        var var_req =""
        if(document.getElementById("ont_recursive").checked){
            var_req="true";
        }else{
            var_req="false";
        }
        cell1.innerHTML=ont_url;
        cell2.innerHTML=var_req;
        var ontology={url:"",recursive:""}
        ontology.url=ont_url;
        ontology.recursive=var_req;
        if (restObj.hasOwnProperty("ontologies")){
        	restObj.ontologies.push(ontology);
        	} else {
        	restObj.ontologies = [ontology];
        	}
    }
    function post() {
    console.log("posting "+restObj);
/*
    const form = document.createElement('form');
    form.method = "POST";
    form.action = "/GenerateCode";
    

    const hiddenField = document.createElement('input');
    hiddenField.type = 'hidden';
    hiddenField.name = "CodeGenerator";
    hiddenField.value = restObj;
    form.appendChild(hiddenField);
    document.body.appendChild(form);
    form.submit()
   */ 
//--------------------------------
   
    ///razón: falta la cabecera CORS 'Access-Control-Allow-Origin'
    //Razón: Solicitud CORS sin éxito
    xhr = new XMLHttpRequest();
    var url = "/GenerateCode";
    
    xhr.open("POST", "http://127.0.0.1:8181/GenerateCode");
    xhr.setRequestHeader("Content-type", "application/json");
    xhr.setRequestHeader("Access-Control-Allow-Origin","*")
    xhr.onreadystatechange = function () { 
        if (xhr.readyState == 4 && xhr.status == 200) {
            console.log("readyState= "+xhr.readyState + " statusText= "+xhr.statusText);
        }else{
            console.log("somethig wrong?");
            console.log("readyState= "+xhr.readyState + " statusText= "+xhr.statusText);
            }
    }
    xhr.send(restObj);
    
 
	}
    </script>
</head>
<body>
        <h1>CodeGenerator tool</h1>
    <fieldset class="fieldset">
        <form name="CodeGenerator" method="POST" action="/GenerateCode">
            <div id="coordinator_div">
                 <p class="coordinator_path">XmlCoordinator path</p>   <input type="text" id="coordinator" class="coordinator_path"  onchange="changeTemplate()"><br>
            </div>
            <div class="c1">
                    <table id="ont_table">
                            <tr>
                                <th>Ontology URL</th>
                                <th>Recursive</th>
                            </tr>
                        </table>
                        <fieldset class="fieldset" id="ont_fieldset">
                        <legend>Ontologies</legend>
                
                        <input type="text" id="ontology"><br>
                        <input type="button" onclick="addOnt()" value="add">
                        <input type="checkbox"   id="ont_recursive">load recursively<br>
                
                        </fieldset>

            </div>
            <div class="c1">
                    <table id="variables_table">
                            <tr>
                                <th>Variable name</th>
                                <th>Variable value</th>
                            </tr>
                        </table>
                        <fieldset class="fieldset" id="vars_dieldset">
                            <legend>varaibles:</legend>
                            Name: <input type="text" id="var_name"><br>
                            Value: <input type="text" id="var_val"><br>
                        <input type="button" onclick="addRow()" value="add">
                        </fieldset>

            </div>
   
    

            <input type="button" value="GenerateCode" onclick="post()">
          </form>
    </fieldset>
        
 
</body>
</html>
